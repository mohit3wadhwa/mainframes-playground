IDENTIFICATION DIVISION.
PROGRAM-ID. MQPUTEX.

ENVIRONMENT DIVISION.

DATA DIVISION.
WORKING-STORAGE SECTION.

* CONNECTION AND OBJECT HANDLES
01  WS-HCONN           PIC S9(9) BINARY VALUE 0.
01  WS-HOBJ            PIC S9(9) BINARY VALUE 0.

* RETURN CODES
01  WS-COMPCODE        PIC S9(9) BINARY VALUE 0.
01  WS-REASON          PIC S9(9) BINARY VALUE 0.

* MQ CONSTANTS / COPYBOOKS (SITE-SPECIFIC)
* THESE COPY STATEMENTS ASSUME STANDARD IBM MQ COPYBOOK NAMES
* UNCOMMENT AND ADAPT TO YOUR INSTALLATION.
/*
COPY CMQMDV.    *> MQMD  - MESSAGE DESCRIPTOR
COPY CMQPMOV.   *> MQPMO - PUT MESSAGE OPTIONS
COPY CMQODV.    *> MQOD  - OBJECT DESCRIPTOR
COPY CMQV.      *> MQ CONSTANTS
*/

* IF COPYBOOKS ARE NOT AVAILABLE, DEFINE MINIMAL FIELDS YOURSELF.

01  MQMD.
    05 MQMD-STRUCTID       PIC X(4) VALUE 'MD  '.
    05 MQMD-FORMAT         PIC X(8) VALUE 'MQSTR   '.
    05 MQMD-MSGTYPE        PIC S9(9) BINARY VALUE 1.
    05 MQMD-EXPIRY         PIC S9(9) BINARY VALUE -1.
    05 MQMD-PERSISTENCE    PIC S9(9) BINARY VALUE 1.
    05 MQMD-MSGID          PIC X(24) VALUE ALL LOW-VALUE.
    05 MQMD-CORRELID       PIC X(24) VALUE ALL LOW-VALUE.
    05 MQMD-REPLYTOQ       PIC X(48) VALUE SPACES.
    05 MQMD-REPLYTOQMGR    PIC X(48) VALUE SPACES.
    05 MQMD-USERID         PIC X(12) VALUE SPACES.
    05 MQMD-APPLIDENTITY   PIC X(32) VALUE SPACES.

01  MQPMO.
    05 MQPMO-OPTIONS       PIC S9(9) BINARY VALUE 0.

01  MQOD.
    05 MQOD-OBJECTNAME     PIC X(48) VALUE SPACES.
    05 MQOD-OBJECTQMGRNAME PIC X(48) VALUE SPACES.

* QUEUE NAME AND MESSAGE BUFFER
01  WS-QUEUE-NAME         PIC X(48) VALUE 'YOUR.QUEUE.NAME'.
01  WS-QMGR-NAME          PIC X(48) VALUE SPACES.

01  WS-MSG-BUFFER.
    05 WS-MSG-TEXT        PIC X(80)
       VALUE 'HELLO FROM COBOL MQ SAMPLE PROGRAM'.
01  WS-MSG-LEN            PIC S9(9) BINARY VALUE 0.

PROCEDURE DIVISION.
MAIN-SECTION.

* SET OBJECT DESCRIPTOR
    MOVE WS-QUEUE-NAME TO MQOD-OBJECTNAME.
    MOVE WS-QMGR-NAME  TO MQOD-OBJECTQMGRNAME.

* CONNECT TO QUEUE MANAGER (IF REQUIRED AT YOUR SITE)
* SOME ENVIRONMENTS HANDLE CONNECTION OUTSIDE THE PROGRAM.
* CALL 'MQCONN' USING
*        WS-QMGR-NAME
*        WS-HCONN
*        WS-COMPCODE
*        WS-REASON.
* IF WS-COMPCODE NOT = 0
*    DISPLAY 'MQCONN FAILED, REASON=' WS-REASON
*    GO TO END-PGM
* END-IF.

* OPEN QUEUE FOR OUTPUT
    MOVE 0 TO WS-COMPCODE WS-REASON.
    CALL 'MQOPEN' USING
         WS-HCONN
         MQOD
         16          *> MQOO_OUTPUT (simplified; use constant from CMQV normally)
         WS-HOBJ
         WS-COMPCODE
         WS-REASON.
    IF WS-COMPCODE NOT = 0
       DISPLAY 'MQOPEN FAILED, REASON=' WS-REASON
       GO TO END-PGM
    END-IF.

* PREPARE MESSAGE DESCRIPTOR AND OPTIONS
    MOVE 1    TO MQMD-MSGTYPE.     *> MQMT_DATAGRAM (example)
    MOVE -1   TO MQMD-EXPIRY.      *> NEVER EXPIRE
    MOVE 1    TO MQMD-PERSISTENCE. *> PERSISTENT
    MOVE 0    TO MQPMO-OPTIONS.    *> SIMPLE OPTIONS, NO SYNCPOINT

    MOVE LENGTH OF WS-MSG-TEXT TO WS-MSG-LEN.

* PUT THE MESSAGE
    CALL 'MQPUT' USING
         WS-HCONN
         WS-HOBJ
         MQMD
         MQPMO
         WS-MSG-LEN
         WS-MSG-BUFFER
         WS-COMPCODE
         WS-REASON.
    IF WS-COMPCODE = 0
       DISPLAY 'MQPUT SUCCESSFUL TO QUEUE ' WS-QUEUE-NAME
    ELSE
       DISPLAY 'MQPUT FAILED, REASON=' WS-REASON
    END-IF.

* CLOSE QUEUE
    CALL 'MQCLOSE' USING
         WS-HCONN
         WS-HOBJ
         0
         WS-COMPCODE
         WS-REASON.

* DISCONNECT (IF YOU DID MQCONN ABOVE)
*   CALL 'MQDISC' USING
*        WS-HCONN
*        WS-COMPCODE
*        WS-REASON.

END-PGM.
    STOP RUN.
